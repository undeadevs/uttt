<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Ultimate Tic Tac Toe</title>
		<style>
		.game{
		display: grid;
		grid-template-columns: repeat(3, 12rem);
		grid-template-rows: repeat(3, 12rem);
		gap: 1rem;
		}
		.sgame{
		display: grid;
		grid-template-columns: repeat(3, 4rem);
		grid-template-rows: repeat(3, 4rem);
		position: relative;
		}
		.sgame > button{
		font-size: 2rem;
		}
		.sgame.X::before {
		content: 'X';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		display: grid;
		place-content: center;
		font-size: 4rem;
		background-color: grey;
		z-index: 10;
		}
		.sgame.O::before {
		content: 'O';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		display: grid;
		place-content: center;
		font-size: 4rem;
		background-color: grey;
		z-index: 10;
		}
		</style>
	</head>
	<body>	
		<div class="game">
			<div class="sgame">
				<button onclick="takeTurn(event.target, 0, 0)"></button>
				<button onclick="takeTurn(event.target, 0, 1)"></button>
				<button onclick="takeTurn(event.target, 0, 2)"></button>
				<button onclick="takeTurn(event.target, 0, 3)"></button>
				<button onclick="takeTurn(event.target, 0, 4)"></button>
				<button onclick="takeTurn(event.target, 0, 5)"></button>
				<button onclick="takeTurn(event.target, 0, 6)"></button>
				<button onclick="takeTurn(event.target, 0, 7)"></button>
				<button onclick="takeTurn(event.target, 0, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 1, 0)"></button>
				<button onclick="takeTurn(event.target, 1, 1)"></button>
				<button onclick="takeTurn(event.target, 1, 2)"></button>
				<button onclick="takeTurn(event.target, 1, 3)"></button>
				<button onclick="takeTurn(event.target, 1, 4)"></button>
				<button onclick="takeTurn(event.target, 1, 5)"></button>
				<button onclick="takeTurn(event.target, 1, 6)"></button>
				<button onclick="takeTurn(event.target, 1, 7)"></button>
				<button onclick="takeTurn(event.target, 1, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 2, 0)"></button>
				<button onclick="takeTurn(event.target, 2, 1)"></button>
				<button onclick="takeTurn(event.target, 2, 2)"></button>
				<button onclick="takeTurn(event.target, 2, 3)"></button>
				<button onclick="takeTurn(event.target, 2, 4)"></button>
				<button onclick="takeTurn(event.target, 2, 5)"></button>
				<button onclick="takeTurn(event.target, 2, 6)"></button>
				<button onclick="takeTurn(event.target, 2, 7)"></button>
				<button onclick="takeTurn(event.target, 2, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 3, 0)"></button>
				<button onclick="takeTurn(event.target, 3, 1)"></button>
				<button onclick="takeTurn(event.target, 3, 2)"></button>
				<button onclick="takeTurn(event.target, 3, 3)"></button>
				<button onclick="takeTurn(event.target, 3, 4)"></button>
				<button onclick="takeTurn(event.target, 3, 5)"></button>
				<button onclick="takeTurn(event.target, 3, 6)"></button>
				<button onclick="takeTurn(event.target, 3, 7)"></button>
				<button onclick="takeTurn(event.target, 3, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 4, 0)"></button>
				<button onclick="takeTurn(event.target, 4, 1)"></button>
				<button onclick="takeTurn(event.target, 4, 2)"></button>
				<button onclick="takeTurn(event.target, 4, 3)"></button>
				<button onclick="takeTurn(event.target, 4, 4)"></button>
				<button onclick="takeTurn(event.target, 4, 5)"></button>
				<button onclick="takeTurn(event.target, 4, 6)"></button>
				<button onclick="takeTurn(event.target, 4, 7)"></button>
				<button onclick="takeTurn(event.target, 4, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 5, 0)"></button>
				<button onclick="takeTurn(event.target, 5, 1)"></button>
				<button onclick="takeTurn(event.target, 5, 2)"></button>
				<button onclick="takeTurn(event.target, 5, 3)"></button>
				<button onclick="takeTurn(event.target, 5, 4)"></button>
				<button onclick="takeTurn(event.target, 5, 5)"></button>
				<button onclick="takeTurn(event.target, 5, 6)"></button>
				<button onclick="takeTurn(event.target, 5, 7)"></button>
				<button onclick="takeTurn(event.target, 5, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 6, 0)"></button>
				<button onclick="takeTurn(event.target, 6, 1)"></button>
				<button onclick="takeTurn(event.target, 6, 2)"></button>
				<button onclick="takeTurn(event.target, 6, 3)"></button>
				<button onclick="takeTurn(event.target, 6, 4)"></button>
				<button onclick="takeTurn(event.target, 6, 5)"></button>
				<button onclick="takeTurn(event.target, 6, 6)"></button>
				<button onclick="takeTurn(event.target, 6, 7)"></button>
				<button onclick="takeTurn(event.target, 6, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 7, 0)"></button>
				<button onclick="takeTurn(event.target, 7, 1)"></button>
				<button onclick="takeTurn(event.target, 7, 2)"></button>
				<button onclick="takeTurn(event.target, 7, 3)"></button>
				<button onclick="takeTurn(event.target, 7, 4)"></button>
				<button onclick="takeTurn(event.target, 7, 5)"></button>
				<button onclick="takeTurn(event.target, 7, 6)"></button>
				<button onclick="takeTurn(event.target, 7, 7)"></button>
				<button onclick="takeTurn(event.target, 7, 8)"></button>
			</div>
			<div class="sgame">
				<button onclick="takeTurn(event.target, 8, 0)"></button>
				<button onclick="takeTurn(event.target, 8, 1)"></button>
				<button onclick="takeTurn(event.target, 8, 2)"></button>
				<button onclick="takeTurn(event.target, 8, 3)"></button>
				<button onclick="takeTurn(event.target, 8, 4)"></button>
				<button onclick="takeTurn(event.target, 8, 5)"></button>
				<button onclick="takeTurn(event.target, 8, 6)"></button>
				<button onclick="takeTurn(event.target, 8, 7)"></button>
				<button onclick="takeTurn(event.target, 8, 8)"></button>
			</div>
		</div>
		<script>
			let chosenBoard = null;
			let turn = "X";
			const bigBoard = new Array(9).fill(undefined).map(()=>({}));
			const boards = new Array(9)
				.fill(undefined)
				.map(()=>new Array(9).fill(undefined).map(()=>({})));
			function takeTurn(button, board, pos){
				if(chosenBoard!==null && board!==chosenBoard) return alert("Not allowed to place here");
				if(bigBoard[board]==="X" || bigBoard[board]==="O") return alert("Board already taken!");
				if(boards[board][pos]==="X" || boards[board][pos]==="O") return alert("Position already taken");
				boards[board][pos]=turn;
				button.textContent=turn;
				button.disabled=true;
				const boardResult = evaluateBoard(boards[board]);
				bigBoard[board] = boardResult ?? {};
				if(boardResult){
					button.parentElement.classList.add(boardResult);
				}
				chosenBoard=pos;
				if(bigBoard[chosenBoard]==="X" || bigBoard[chosenBoard]==="O"){
					chosenBoard=null;
				}
				const bigBoardResult = evaluateBoard(bigBoard);
				if(bigBoardResult==="X" || bigBoardResult==="O"){
					setTimeout(()=>{
						alert(`${turn} wins!`);
					},0)
					return;
				}
				turn=turn==="X"?"O":"X";

			}
			function evaluateBoard(board){
				const vert = new Array(3).fill(undefined)
					.map((_,i)=>board[i]===board[i+3] && board[i]===board[i+6] ? board[i] : null).reduce((a,b)=>a??b,null);
				const horz = new Array(3).fill(undefined)
					.map((_,i)=>board[i*3]===board[i*3+1] && board[i*3]===board[i*3+2] ? board[i*3] : null).reduce((a,b)=>a??b,null);
				const diag1 = board[0]===board[4] && board[0]===board[8] ? board[0] : null;
				const diag2 = board[2]===board[4] && board[2]===board[6] ? board[2] : null;
				return (vert ?? horz ?? diag1 ?? diag2);
			}
		</script>
	</body>
</html>
